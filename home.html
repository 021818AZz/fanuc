<!DOCTYPE html>
<html class="pixel-ratio-3 retina android android-5 android-5-0 watch-active-state">
<head>
    <meta -equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta -equiv="pragma" content="no-cache">
    <meta -equiv="cache-control" content="no-cache">
    <meta -equiv="expires" content="0">
    <title>fanucss</title>
    <link rel="stylesheet" href="app2.css">
    <link rel="stylesheet" href="incont2.css">
    <link rel="stylesheet" href="style.css">
    <script type="text/javascript" src="/static/home/js/TouchSlide.1.1.js"></script>
    <script type="text/javascript" src="/static/home/js/jquery-1.11.3.min.js"></script>
    <script type="text/javascript" src="/static/home/js/layer.js"></script>
    <style type="text/css">
        * {
            margin: 0;
            padding: 0;
            list-style: none;
        }

        body {
            background: #fafafa;
        }

        .index_top_img img {
            height: 10rem;
            width: 100%;
        }

        .page-content {
            background: #fff;
            padding: 0px 0 10px;
        }

        .bd .pic img {
            width: 100%;
            height: 160px;
        }
        .vip{
            background: #fc5f2e;
            color: #fff;
            font-size: 10px;
            border-radius: 8px;
            padding: 2px 5px;
            margin-left: 10px;
            letter-spacing:1px;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background-color: #fff;
            border-radius: 10px;
            width: 90%;
            max-width: 400px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }
        
        .close-modal {
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }
        
        .modal-body {
            margin-bottom: 20px;
        }
        
        .product-info {
            display: flex;
            margin-bottom: 15px;
        }
        
        .product-image {
            width: 100px;
            height: 100px;
            border-radius: 5px;
            margin-right: 15px;
        }
        
        .product-details {
            flex: 1;
        }
        
        .product-name {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .product-price {
            font-size: 18px;
            color: #df9301;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .product-daily-income {
            font-size: 14px;
            color: #333;
            margin-bottom: 5px;
        }
        
        .product-period {
            font-size: 14px;
            color: #666;
        }
        
        .modal-footer {
            display: flex;
            justify-content: space-between;
        }
        
        .modal-btn {
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            border: none;
        }
        
        .cancel-btn {
            background-color: #ccc;
            color: #333;
        }
        
        .confirm-btn {
            background-color: #df9301;
            color: #fff;
        }
        
        /* Toast Styles */
        .toast {
            position: fixed;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #333;
            color: #fff;
            padding: 10px 20px;
            border-radius: 5px;
            z-index: 1001;
            display: none;
        }
        
        .toast.success {
            background-color: #4CAF50;
        }
        
        .toast.error {
            background-color: #f44336;
        }
        
        .earnings_list{
            padding: 10px;
            margin-bottom: 50px;
        }
        .earnings_item{
            margin: 10px 0;
            background-color: #ffffff;
            border-radius: 10px;
            padding: 10px;
            position: relative;
        }
        .earnings_item_top{
            display: flex;
            flex-direction: row;
        }
        .earnings_item_btn{
            width:  40%;
            height: 2rem;
            background: #df9301;
            display: block;
            margin-top: 1rem;
            font-size: 14px;
            text-align: center;
            line-height: 2rem;
            border-radius: 2rem;
            color: #fff;
            margin-left: 30%;
        }
        
        .earnings_item_need_btn{
            width: 100%;
            height: 2rem;
            background: linear-gradient(90deg, #ccc, #666);
            display: block;
            margin-top: 1rem;
            font-size: 14px;
            text-align: center;
            line-height: 2rem;
            border-radius: 2rem;
            color: #fff;
        }
        
        .earnings_item_btn_clos{
            width: 40%;
            height: 2rem;
            background: linear-gradient(90deg, #cdcdcd, #afafaf);
            display: block;
            margin-top: 1rem;
            font-size: 14px;
            text-align: center;
            line-height: 2rem;
            border-radius: 2rem;
            color: #fff;
            text-align: center;
            margin-left: 30%;
        }
        .earnings_img{
            width: 80px;
            height: 80px;
        }
        .earnings_img img{
            width: 100%;
            height: 100%;
            border-radius: 5px;
        }
        .earnings_message{
            padding-left: 10px;
            width: calc(100% - 80px);
        }
        .earnings_title{
            font-size: 14px;
            font-weight: bold;
        }
        .earnings_bq {margin-top: 10px;}
        .earnings_bq span{
            font-size: 10px;
            background-color: #fdfaf4;
            color: black;
            padding: 2px 3px;
            border-radius: 20px;
            margin-right: 2px;
        }
        .earnings_p{
            display: flex;
            flex-direction: row;
            margin-top: 10px;
        }
        .earnings_p_box{
            width: 50%;
        }
        .earnings_p_box span{
            font-size: 20px;
            font-weight: bold;
            color: black;
        }
        .earnings_p_box div{
            font-size: 12px;
            color: #979797;
            
        }
        .earnings_p_p1{
            text-decoration:line-through;
            color: #979797!important;
            font-size: 16px!important;
        }
        .earnings_vip{
        }
        .earnings_vip img{
            height: 18px;
            width: 60px;
        }
        
    .note_msg p {
   margin: 0 22px 0 22px; 
    word-wrap: break-word;
}

.note_msg span {
    word-wrap: break-word;
}

.note_msg {
    width: 100%;
    max-height: 60vh;
    text-align: center;
    word-wrap: break-word;
    word-break: break-all;
}
        .note_msg::-webkit-scrollbar {
          width : 5px;  
          height: 1px;
        }
        .note_msg::-webkit-scrollbar-thumb {
          border-radius: 5px;
          box-shadow   : inset 0 0 5px rgba(0, 0, 0, 0.2);
          background   : #00A398;
        }
        .note_msg::-webkit-scrollbar-track {
          box-shadow   : inset 0 0 5px rgba(0, 0, 0, 0.2);
          border-radius: 5px;
          background   : #ededed;
        }
        @keyframes  shaking {
            0% {transform:rotate(0deg);}
            10% {transform:rotate(9deg);}
            20% {transform:rotate(-9deg);}
            30% {transform:rotate(9deg);}
            40% {transform:rotate(-9deg);}
            50% {transform:rotate(0deg);}
        }
        .shakings{
            -webkit-animation: shaking 0.5s linear infinite;
            animation: shaking 0.5s linear infinite;
        }
        .tipmian{
            position:relative;
        }
        .tip{
            display: block;
            background-color: red;
            color: #fff;
            font-size: 12px;
            padding: 1px 10px;
            font-weight: bold;
            border-radius: 20px;
            position:absolute;
            right: 5px;
            top: 5px;
            z-index: 100;
        }

        .mycount{ 
            font-size: 12px; 
            padding: 3px 10px; 
            background-color: #ff6300; 
            background: #df9301;
            color: #fff;
            position:absolute;
            right: 0;
            border-radius:10px 0 0 10px;
        }
        
    </style>
</head>
<body>
  <div class="page-content">
       <img src="https://fanucss.shop//fan.jpg"/ width="100%" style="transform: scale(0.9);margin-top:8px">
      </div>
<div class="page-content">
      
    <div id="slideBox" class="slideBox">
        <div class="bd" style="margin-top: 0px;">
            <ul>
                                    <li>
                        <a class="pic" href="#">
                            <img src="https://fanucss.shop/uploads/image/20250610/4d23b55aadeb8602d15e36a524da959d.jpg" alt="banner1"/>
                        </a>
                    </li>
                                    <li>
                        <a class="pic" href="#">
                            <img src="https://fanucss.shop/uploads/image/20250610/2b061537682ba6deab1117abfbe7b024.jpg" alt="banner2"/>
                        </a>
                    </li>
                                    <li>
                        <a class="pic" href="javascript:void(0);">
                            <img src="https://fanucss.shop/uploads/image/20250610/3899680dd3c5a0ffc03dfe7c9487c281.jpg" alt="banner3"/>
                        </a>
                    </li>
                            </ul>
        </div>
        <div class="hd">
            <ul></ul>
        </div>
    </div>
</div>


<div class="page-index-nav">
    <div class="page-index-nav-ul">
 <ul>
    <li>
        <a href="serviço.html" onclick="sign_in()">
            <img src="https://fanucss.shop/wwkk.jpg" style="width:3rem;height:3rem;"  />
           <p>Serviço</p>
        </a>
    </li>
    <li>
        <a href="recarregar.html">
            <img src="https://fanucss.shop/wwr1.png" style="width:3rem;height:3rem"/>
            <p>recarga</p>
        </a>
    </li>
    <li>
        <a href="equipe.html">
            <img src="https://fanucss.shop/wwr2.png" style="width:3rem;height:3rem" />
            <p>equipe</p>
        </a>
    </li>
    <li>
        <a href="tabela.html">
            <img src="https://fanucss.shop/wwr3.png" style="width:3rem;height:3rem"/>
            <p>Tabela</p>
        </a>
    </li>
</ul>
    </div>
</div>

<div class="earnings_list">
    	<div class="earnings_item">
        <div class="mycount">Cota 0 / 99</div>
		<div class="earnings_item_top">
			<div class="earnings_img">
				<img src="https://fanucss.shop/uploads/image/20250610/5a1aa1fa6b66d41ab44eccb61555df11.jpg" />
			</div>
			<div class="earnings_message">
				<div class="earnings_title">fanucss-1</div>
				<div class="earnings_bq">
					<span>90 Dias</span>
				</div>
				<div class="earnings_p">
					<div class="earnings_p_box">
						<span>KZ 270</span>
						<div>Renda diária</div>
					</div>									
					<div class="earnings_p_box">
						<span>KZ 2700</span>
						<div>Preço do produto</div>
					</div>
				</div>
			</div>						
		</div>
		<a class="earnings_item_btn" href="javascript:void(0);" onclick="showProductModal('fanucss-1', 2700, 270, 270*90, '90 Dias', 'https://fanucss.shop/uploads/image/20250610/5a1aa1fa6b66d41ab44eccb61555df11.jpg')">
			Investir Agora
		</a>
	</div>
	
	<div class="earnings_item">
        <div class="mycount">Cota 0 / 99</div>
		<div class="earnings_item_top">
			<div class="earnings_img">
				<img src="https://fanucss.shop/uploads/image/20250610/a2baf99d68d61a3ef9b3a2f0e0809929.jpg" />
			</div>
			<div class="earnings_message">
				<div class="earnings_title">fanucss-2</div>
				<div class="earnings_bq">
					<span>90 Dias</span>
				</div>
				<div class="earnings_p">
					<div class="earnings_p_box">
						<span>KZ 1500</span>
						<div>Renda diária</div>
					</div>									
					<div class="earnings_p_box">
						<span>KZ 15000</span> 
						<div>Preço do produto</div>
					</div>
				</div>
			</div>						
		</div>
		<a class="earnings_item_btn" href="javascript:void(0);" onclick="showProductModal('fanucss-2', 15000, 1500, 1500*90, '90 Dias', 'https://fanucss.shop/uploads/image/20250610/a2baf99d68d61a3ef9b3a2f0e0809929.jpg')">
			Investir Agora
		</a>
	</div>
	
	<div class="earnings_item">
        <div class="mycount">Cota 0 / 99</div>
		<div class="earnings_item_top">
			<div class="earnings_img">
				<img src="https://fanucss.shop/uploads/image/20250610/3442ce0017912fdbf0a184aeaf86703b.jpg" />
			</div>
			<div class="earnings_message">
				<div class="earnings_title">fanucss-3</div>
				<div class="earnings_bq">
					<span>90 Dias</span>
				</div>
				<div class="earnings_p">
					<div class="earnings_p_box">
						<span>KZ 5500</span>
						<div>Renda diária</div>
					</div>									
					<div class="earnings_p_box">
						<span>KZ 55000</span> 
						<div>Preço do produto</div>
					</div>
				</div>
			</div>						
		</div>
		<a class="earnings_item_btn" href="javascript:void(0);" onclick="showProductModal('fanucss-3', 55000, 5500, 5500*90, '90 Dias', 'https://fanucss.shop/uploads/image/20250610/3442ce0017912fdbf0a184aeaf86703b.jpg')">
			Investir Agora
		</a>
	</div>
	
	<div class="earnings_item">
        <div class="mycount">Cota 0 / 99</div>
		<div class="earnings_item_top">
			<div class="earnings_img">
				<img src="https://fanucss.shop/uploads/image/20250610/d17efd05442633495ab5336e321591e1.jpg" />
			</div>
			<div class="earnings_message">
				<div class="earnings_title">fanucss-4</div>
				<div class="earnings_bq">
					<span>90 Dias</span>
				</div>
				<div class="earnings_p">
					<div class="earnings_p_box">
						<span>KZ 19600</span>
						<div>Renda diária</div>
					</div>									
					<div class="earnings_p_box">
						<span>KZ 196000</span> 
						<div>Preço do produto</div>
					</div>
				</div>
			</div>						
		</div>
		<a class="earnings_item_btn" href="javascript:void(0);" onclick="showProductModal('fanucss-4', 196000, 19600, 19600*90, '90 Dias', 'https://fanucss.shop/uploads/image/20250610/d17efd05442633495ab5336e321591e1.jpg')">
			Investir Agora
		</a>
	</div>
	
	<div class="earnings_item">
        <div class="mycount">Cota 0 / 99</div>
		<div class="earnings_item_top">
			<div class="earnings_img">
				<img src="https://fanucss.shop/uploads/image/20250610/593162771dd01c07c59878f99fbcab17.jpg" />
			</div>
			<div class="earnings_message">
				<div class="earnings_title">fanucss-5</div>
				<div class="earnings_bq">
					<span>90 Dias</span>
				</div>
				<div class="earnings_p">
					<div class="earnings_p_box">
						<span>KZ 50000</span>
						<div>Renda diária</div>
					</div>									
					<div class="earnings_p_box">
						<span>KZ 500000</span> 
						<div>Preço do produto</div>
					</div>
				</div>
			</div>						
		</div>
		<a class="earnings_item_btn" href="javascript:void(0);" onclick="showProductModal('fanucss-5', 500000, 50000, 50000*90, '90 Dias', 'https://fanucss.shop/uploads/image/20250610/593162771dd01c07c59878f99fbcab17.jpg')">
			Investir Agora
		</a>
	</div>
</div>

<!-- Modal de Produto -->
<div id="productModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <div class="modal-title">Detalhes do Produto</div>
            <span class="close-modal" onclick="hideModal()">&times;</span>
        </div>
        <div class="modal-body">
            <div class="product-info">
                <img id="modalProductImage" class="product-image" src="" alt="Produto">
                <div class="product-details">
                    <div class="product-name" id="modalProductName"></div>
                    <div class="product-price" id="modalProductPrice"></div>
                    <div class="product-daily-income" id="modalProductDailyIncome"></div>
                    <div class="product-period" id="modalProductPeriod"></div>
                </div>
            </div>
            <div style="margin-top: 15px;">
                <p style="font-size: 14px; color: #666;">Renda total estimada: <span id="modalProductTotalIncome" style="color: #df9301; font-weight: bold;"></span></p>
            </div>
        </div>
        <div class="modal-footer">
            <button class="modal-btn cancel-btn" onclick="hideModal()">Cancelar</button>
            <button class="modal-btn confirm-btn" onclick="confirmPurchase()">Confirmar Compra</button>
        </div>
    </div>
</div>

<!-- Toast Notification -->
<div id="toast" class="toast"></div>

<div class="kefu">
    <a href="serviço.html"><img src="https://fanucss.shop/wwkk.jpg" alt=""></a>
</div>

<footer>
     <div class="foot_bo">
        <a href="home.html">
            <img src="https://fanucss.shop/ww4.png"/>
            <p class="xz" style="color: #00A398;">Início</p>
        </a>
    </div>

    <div class="foot_bo">
        <a href="renda.html">
            <img src="https://fanucss.shop/ww6.png"/>
            <p>renda</p>
        </a>
    </div>

    <div class="foot_bo">
        <a href="equipe.html">
            <img src="https://fanucss.shop/ww5.png"/>
            <p>Compartilhar</p>
        </a>
    </div>

    <div class="foot_bo">
        <a href="meu.html">
            <img src="https://fanucss.shop/ww7.png"/>
            <p>Meu</p>
        </a>
    </div>
</footer>

<script>
    // Variáveis globais
    let currentProductData = null;
    let userId = localStorage.getItem("user_id");
    let userBalance = 0;
    
    // Função para mostrar o modal do produto
    function showProductModal(name, price, dailyIncome, totalIncome, period, imageUrl) {
        currentProductData = {
            name: name,
            price: price,
            dailyIncome: dailyIncome,
            totalIncome: totalIncome,
            period: period,
            imageUrl: imageUrl
        };
        
        // Preencher os dados do modal
        document.getElementById('modalProductName').textContent = name;
        document.getElementById('modalProductPrice').textContent = `KZ ${price.toLocaleString('pt-BR')}`;
        document.getElementById('modalProductDailyIncome').textContent = `Renda diária: KZ ${dailyIncome.toLocaleString('pt-BR')}`;
        document.getElementById('modalProductPeriod').textContent = `Período: ${period}`;
        document.getElementById('modalProductTotalIncome').textContent = `KZ ${totalIncome.toLocaleString('pt-BR')}`;
        document.getElementById('modalProductImage').src = imageUrl;
        
        // Mostrar o modal
        document.getElementById('productModal').style.display = 'flex';
    }
    
    // Função para esconder o modal
    function hideModal() {
        document.getElementById('productModal').style.display = 'none';
    }
    
    // Função para confirmar a compra
    async function confirmPurchase() {
        if (!userId) {
            showToast('Usuário não identificado. Faça login novamente.', 'error');
            return;
        }
        
        try {
            // Verificar saldo do usuário
            await getUserBalance(userId);
            
            if (userBalance < currentProductData.price) {
                showToast('Saldo insuficiente para esta compra.', 'error');
                return;
            }
            
            // Registrar a compra
            const purchaseData = {
                userId: userId,
                produto: currentProductData.name,
                preco: currentProductData.price,
                renda_diaria: currentProductData.dailyIncome,
                renda_total: currentProductData.totalIncome,
                prazo: parseInt(currentProductData.period.split(' ')[0]),
                dataCompra: new Date().toISOString()
            };
            
            const purchaseSuccess = await registerPurchase(purchaseData);
            
            if (purchaseSuccess) {
                // Atualizar o saldo do usuário após a compra
                const newBalance = userBalance - currentProductData.price;
                await updateUserBalance(userId, newBalance);
                
                showToast('Compra realizada com sucesso!', 'success');
                hideModal();
                
                // Atualizar o saldo exibido
                updateDisplayedBalance(newBalance);
            } else {
                showToast('Erro ao registrar a compra. Tente novamente.', 'error');
            }
        } catch (error) {
            console.error('Erro:', error);
            showToast('Erro ao processar compra. Tente novamente.', 'error');
        }
    }
    
    // Função para obter saldo do usuário
    async function getUserBalance(userId) {
        try {
            const response = await fetch(`https://api-wped.onrender.com/user/${userId}`);
            if (!response.ok) {
                throw new Error('Erro ao obter saldo do usuário');
            }
            
            const userData = await response.json();
            if (userData && userData.saldo !== undefined) {
                userBalance = userData.saldo;
                return userBalance;
            } else {
                throw new Error('Dados do usuário inválidos');
            }
        } catch (error) {
            console.error('Erro ao obter saldo:', error);
            throw error;
        }
    }
    
    // Função para atualizar saldo do usuário
    async function updateUserBalance(userId, newBalance) {
        try {
            const response = await fetch(`https://api-wped.onrender.com/user/${userId}`, {
                method: 'PATCH',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    saldo: newBalance
                })
            });
            
            if (!response.ok) {
                throw new Error('Erro ao atualizar saldo');
            }
            
            const updatedUser = await response.json();
            userBalance = updatedUser.saldo;
            return true;
        } catch (error) {
            console.error('Erro ao atualizar saldo:', error);
            throw error;
        }
    }
    
    // Função para registrar a compra
    async function registerPurchase(purchaseData) {
        try {
            const response = await fetch('https://api-wped.onrender.com/produto', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(purchaseData)
            });
            
            if (!response.ok) {
                throw new Error('Erro ao registrar compra');
            }
            
            const result = await response.json();
            return true;
        } catch (error) {
            console.error('Erro ao registrar compra:', error);
            throw error;
        }
    }
    
    // Função para atualizar o saldo exibido
    function updateDisplayedBalance(newBalance) {
        // Você pode adicionar lógica aqui para atualizar o saldo exibido na página
        console.log(`Saldo atualizado: KZ ${newBalance.toLocaleString('pt-BR')}`);
    }
    
    // Função para mostrar toast
    function showToast(message, type) {
        const toast = document.getElementById('toast');
        toast.textContent = message;
        toast.className = `toast ${type}`;
        toast.style.display = 'block';
        
        setTimeout(() => {
            toast.style.display = 'none';
        }, 3000);
    }
    
    // Carregar saldo do usuário ao iniciar
    async function loadUserBalance() {
        if (!userId) return;
        
        try {
            const balance = await getUserBalance(userId);
            updateDisplayedBalance(balance);
        } catch (error) {
            console.error('Erro ao carregar saldo:', error);
        }
    }
    
    // Inicialização
    document.addEventListener('DOMContentLoaded', function() {
        loadUserBalance();
    });
</script>
</body>
</html>
